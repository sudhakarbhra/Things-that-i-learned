<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Form List</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.bootstrap4.min.css">
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">




<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" src=" https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js "></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>
<body>
	<div id="main">


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newModal"> New Question</button>
<button type="button" class="btn btn-primary" id="count"> Delete All</button>



		<table id="example" class="display table table-striped" style="width:100%">
	        <thead>
	            <tr>
	                <th>'id'        </th>
	                <th>'select'        </th>
	                <th>'action'        </th>
	                <th>'quizId'    </th>
	                <th>'question'  </th>
	                <th>'quesDesc'  </th>
	                <th>'answer'    </th>
	                <th>'opt1'      </th>
	                <th>'opt1Img'   </th>
	                <th>'opt2'      </th>
	                <th>'opt2Img'   </th>
	                <th>'opt3'      </th>
	               	<th>'opt3Img'   </th>
	                <th>'opt4'      </th>
	                <th>'opt4Img'   </th>
	                <th>'score'     </th>
	            </tr>
	        </thead>   
    	</table>
	</div>

<div class="modal fade" id="newModal">
  <div class="modal-dialog">
    <div class="modal-content">
         <div class="modal-header">
          <h4 class="modal-title">New Form</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">   
		<form id="modalAdd">
			<input type="hidden" name="action" value="add">
			question <br>
			<input type="text" name="question"> <br>
			Question description <br>
			<input type="text" name="quesDesc"><br>
			Answer <br>
			<input type="text" name="answer"> <br>
			option 1 <br>
			<input type="text" name="opt1">
			<input type="file" name="opt1Img"><br>
			option 2 <br>
			<input type="text" name="opt2">
			<input type="file" name="opt2Img"><br>
			option 3 <br>
			<input type="text" name="opt3">
			<input type="file" name="opt3Img"><br>
			option 4 <br>
			<input type="text" name="opt4">
			<input type="file" name="opt4Img"><br>
			Score <br>
			<input type="text" name="score">
			<input type="Submit">
		</form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>


 <!--- Modal -->
  <div class="modal fade" id="editModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Edit Form</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
		<form id="modalEdit">
			<h4>EDIT FORM</h4>
			<input type="hidden" name="action" value="edit">
			<input type="hidden" name="id" id="id">
			question <br>
			<input type="text" name="question" id="question"> <br>
			Question description <br>
			<input type="text" name="quesDesc" id="quesDesc"><br>
			Answer <br>
			<input type="text" name="answer" id="answer"> <br>
			option 1 <br>
			<input type="text" name="opt1" id="opt1">
			<input type="file" name="opt1Img" id="opt1Img"><br>
			option 2 <br>
			<input type="text" name="opt2" id="opt2">
			<input type="file" name="opt2Img" id="opt2Img"><br>
			option 3 <br>
			<input type="text" name="opt3" id="opt3">
			<input type="file" name="opt3Img" id="opt3Img"><br>
			option 4 <br>
			<input type="text" name="opt4" id="opt4">
			<input type="file" name="opt4Img" id="opt4Img"><br>
			Score <br>
			<input type="text" name="score" id="score">
			<input type="Submit">
		</form>
  </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>































</body>

<script>
var table;
var allData = [];
	$(document).ready(function() {
   table = $('#example').DataTable( {
        ajax: "test.php",
        // dom: 'lBfrtip',
        "data": {
        "quizId": 3
    	},
        buttons: [
	                 { extend: 'excel', className: 'btn' },
	                 { extend: 'pdf', className: 'btn' },
	                 { extend: 'print', className: 'btn' }
                ],
        columnDefs: [
                        { targets: [8,10,12,14],
                        	render: function(data) { return '<img src="'+data+'">' }
                        },
                        { targets: 2,
                            render: function(data) {
                            return '<a onclick="editModal('+data+');"><i class="fa fa-edit"></i></a><a onclick="deleteThis('+data+');"><i class="fa fa-trash"></i></a>';
                        	}
                        },
                        { targets: 1,
                            render: function(data) {
                            return '<input type="checkbox" name="allInAll" value='+data+'>';
                        	}
                        }   
                    ],
        columns: [
            { data: "id" },
            { data: "id" },
            { data: "id" },
            { data: "quizId" },
            { data: "question" },
            { data: "quesDesc" },
            { data: "answer" },
            { data: "opt1" },
            { data: "opt1Img" },
            { data: "opt2" },
            { data: "opt2Img" },
            { data: "opt3" },
            { data: "opt3Img" },
            { data: "opt4" },
            { data: "opt4Img" },
            { data: "score" }
        ]
    } );

} );




//plain modal
$('#newBtn').click(function(){
  $("#newModal").modal();
});


//Adding new
$('#modalAdd').submit(function(){
$.ajax({
  type: 'POST',
  url: "crud.php",
  data: $(this).serialize()
  })
    .done(function(data){ 
      alert(data);
     table.ajax.reload();
      $('#newModal').modal('hide');
    })
      .fail(function() { 
        alert( "Posting failed." );
      });
        return false;
        });



//Edditing Form Submission
$('#modalEdit').submit(function(){
$.ajax({
  type: 'POST',
  url: "crud.php",
  data: $(this).serialize()
  })
    .done(function(data){ 
      alert(data);
     table.ajax.reload();
      $('#myModal').modal('hide');
    })
      .fail(function() { 
        alert( "Posting failed." );
      });
        return false;
        });


 
    $('#count').click( function () {  
            $.each($("input[name='allInAll']:checked"), function(){   
              allData.push($(this).val());
            });
            console.log(allData);
            deleteAll(allData);
    } );

// Delete pop up
function deleteThis(data){
  swal({
  title: "Are you sure?",
  text: "Once deleted, you will not be able to recover this file!",
  buttons: true,
  dangerMode: true,
}).then((willDelete) => {
  if (willDelete) {
  	console.log(data);
    $.ajax({    url: "crud.php",
                type: "POST",
                data: {id: data,action:"delete"},
                success: function(data) {
                  console.log(data);
                  table.ajax.reload();
                  swal(data, {
                  icon: "success",
                });
                  
               },                
                error: function() {
                  swal("There was an error. Try again please!");
                }
            });
  } else {swal("Your Data is safe");}
});  

}




// Edit Form
function editModal(data){

	console.log("Editing");

  $.ajax({      url: "crud.php",
                type: "POST",
                data: {id: data,action:"fetchMe"},
                success: function(data) {
                  var p_data = JSON.parse(data);
                  console.log(data);
                

 $("#id").val(p_data.id);
 $("#quizId").val(p_data.quizId);
 $("#question").val(p_data.question);
 $("#quesDesc").val(p_data.quesDesc);
 $("#answer").val(p_data.answer);
 $("#opt1").val(p_data.opt1);
 // $("#opt1Img").val(p_data.opt1Img);
 $("#opt2").val(p_data.opt2);
 // $("#opt2Img").val(p_data.opt2Img);
 $("#opt3").val(p_data.opt3);
 // $("#opt3Img").val(p_data.opt3Img);
 $("#opt4").val(p_data.opt4);
 // $("#opt4Img").val(p_data.opt4Img);
 $("#score").val(p_data.score);



$("#editModal").modal();
                
               },                
                error: function() {
                  swal("There was an error. Try again please!");
                }
            });

}

//Delete All
function deleteAll(data){
         swal({
  title: "Are you sure?",
  text: "Once deleted, you will not be able to recover this file!",
  buttons: true,
  dangerMode: true,
}).then((willDelete) => {
  if (willDelete) {
    $.ajax({    url: "crud.php",
                type: "POST",
                data: {id: data,action:"deleteMulti"},
                success: function(data) {
                  console.log(data);
                 table.ajax.reload();
                  swal(data, {
                  icon: "success",
                });
               },                
                error: function() {
                  swal("There was an error. Try again please!");
                }
            });
  } else {swal("Your Data is safe");}
});

   
}











</script>
<style>
	body{
		font-family: Roboto;
		font-size: 14px;
	}
	img{
		width: 25px;
	}
	.fa{
		padding:10px;
	}
</style>
</html>